<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Écrire des tests pour le backend &mdash; Documentation Zeste de Savoir dev</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Installation" href="../install.html" />
    <link rel="prev" title="Lancer les tests du backend" href="backend-tests.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Zeste de Savoir
          </a>
              <div class="version">
                dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../guides.html">Guides pas-à-pas</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install-linux.html">Installer Zeste de Savoir sur Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="update-env.html">Mettre à jour son environnement de développement</a></li>
<li class="toctree-l2"><a class="reference internal" href="run-linux.html">Lancer Zeste de Savoir sur Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="backend-tests.html">Lancer les tests du <em>backend</em></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Écrire des tests pour le <em>backend</em></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comprendre-la-politique-de-tests">Comprendre la politique de tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#identifier-ce-qu-il-faut-tester">Identifier ce qu’il faut tester</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quelles-sont-les-limites-de-la-chose-testee">Quelles sont les limites de la chose testée ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#est-ce-que-les-limites-identifiees-sont-les-bonnes">Est-ce que les limites identifiées sont les bonnes ?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#organiser-les-tests">Organiser les tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#separer-les-niveaux-d-abstraction">Séparer les niveaux d’abstraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eviter-les-duplications">Éviter les duplications</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decouper-en-fichiers">Découper en fichiers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#connaitre-les-outils-pratiques">Connaître les outils pratiques</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribuer à Zeste de Savoir</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html"><em>Workflow</em> et détails pratiques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../back-end.html">Le <em>back-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../back-end-code.html">Documentation technique du <em>back-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../front-end.html">Le <em>front-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Makefile et autres outils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../delay-issue.html">Problème de lenteur lors du dev ?</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Zeste de Savoir</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../guides.html">Guides pas-à-pas</a> &raquo;</li>
      <li>Écrire des tests pour le <em>backend</em></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/write-backend-tests.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ecrire-des-tests-pour-le-backend">
<h1>Écrire des tests pour le <em>backend</em><a class="headerlink" href="#ecrire-des-tests-pour-le-backend" title="Lien permanent vers cette rubrique"></a></h1>
<p>Zeste de Savoir aspire à avoir une base de code aussi qualitative et maintenable que possible, notamment grâce à une suite de tests automatisés pour le <em>backend</em> Python. Lorsqu’on développe pour Zeste de Savoir, on est ainsi amené à modifier cette suite de tests et ainsi contribuer à la qualité du code.</p>
<p>Ce guide est destiné aux contributeurs qui recherchent des conseils pour la mise en œuvre des tests <em>backend</em> sur Zeste de Savoir. Si vous souhaitez simplement lancer les tests existants, référez-vous au <a class="reference external" href="./backend-tests.html">guide correspondant</a>.</p>
<section id="comprendre-la-politique-de-tests">
<h2>Comprendre la politique de tests<a class="headerlink" href="#comprendre-la-politique-de-tests" title="Lien permanent vers cette rubrique"></a></h2>
<p>La politique actuelle pour les tests du <em>backend</em> est que tout ce qui est écrit en Python doit être testé. Ce n’est pas entièrement le cas actuellement, mais c’est l’objectif vers lequel on tend.</p>
<p>En conséquence, toute mise à jour du code doit s’accompagner de la création (ou adaptation) de tests pour au minimum couvrir le comportement ajouté ou modifié. L’ajout de tests manquants mais hors du périmètre de la modification n’est pas requis.</p>
<p>La présence de tests adéquats est vérifiée lors de l’assurance qualité des PR. Toute fusion de PR sans tests associés est exceptionnelle et cantonnée à des situations où la balance bénéfices-risques est acceptable. Accepter une PR sans tests associés est laissé à l’appréciation de l’équipe qui fusionne les PR.</p>
<p>Les contributions destinées purement à l’amélioration des tests sont les bienvenues. En effet, l’historique du projet fait que certaines parties du projet sont peu, mal, ou pas testées automatiquement.</p>
<p>Quoi qu’il en soit, l’équipe est disponible sur le canal <code class="docutils literal notranslate"><span class="pre">#dev-de-zds</span></code> de <a class="reference external" href="https://discord.gg/ue5MTKq">notre serveur Discord</a> ou <a class="reference external" href="https://zestedesavoir.com/forums/communaute/dev-zone/">le forum Dev Zone</a> pour vous aider si vous avez des doutes, questions ou difficultés.</p>
</section>
<section id="identifier-ce-qu-il-faut-tester">
<h2>Identifier ce qu’il faut tester<a class="headerlink" href="#identifier-ce-qu-il-faut-tester" title="Lien permanent vers cette rubrique"></a></h2>
<p>Avant d’écrire des tests, il est important d’identifier précisément ce que l’on teste. Cette question peut paraître triviale, mais est pourtant primordiale, car cela change la manière dont les tests seront écrits, les efforts pour ce faire et leur valeur ajoutée.</p>
<section id="quelles-sont-les-limites-de-la-chose-testee">
<h3>Quelles sont les limites de la chose testée ?<a class="headerlink" href="#quelles-sont-les-limites-de-la-chose-testee" title="Lien permanent vers cette rubrique"></a></h3>
<p>Il faut être en mesure de délimiter précisément la chose testée, en précisant son interface (au sens large) : quelles sont les entrées, les sorties, et être capable de relier les unes aux autres.</p>
<p>Par exemple pour une fonction, les entrées incluent naturellement les arguments de la fonction et les sorties les valeurs de retour. Cependant, si la fonction lit ou modifie un état (attributs d’objet, base de données, fichiers), alors les entrées incluent aussi les états initiaux et les sorties les états finaux.</p>
<p>Les entrées et sorties peuvent être des choses complexes. Par contre, si vous n’êtes pas capable de les identifier clairement, c’est peut-être dû à une mauvaise conception de ce que vous souhaitez tester. Essayez de restructurer vos changements !</p>
</section>
<section id="est-ce-que-les-limites-identifiees-sont-les-bonnes">
<h3>Est-ce que les limites identifiées sont les bonnes ?<a class="headerlink" href="#est-ce-que-les-limites-identifiees-sont-les-bonnes" title="Lien permanent vers cette rubrique"></a></h3>
<p>Maintenant que vous avez identifié des limites pour la chose à tester, questionnez-vous sur leur pertinence. Les exemples ci-dessous listent quelques écueils qui peuvent survenir en pratique.</p>
<p><strong>Tester le code du framework au lieu du sien.</strong> Avec Django, on réutilise des classes de base fournies par le <em>framework</em>. Il est assez facile de retester des comportements déjà vérifiés par la classe en question. Par exemple, si vous utilisez des <em>templates views</em>, il n’est pas nécessaire en général de tester automatiquement que le template que vous avez indiqué est bien celui utilisé : c’est à Django de vérifier que la classe fonctionne correctement. C’est d’ailleurs un risque de faire des tests redondants avec le code et donc plus difficile à maintenir dans la durée.</p>
<p><strong>Étendre excessivement le périmètre du test.</strong> Quand on définit l’interface du code à tester, on peut parfois voir grand. Par exemple, on peut être tenté pour une vue de faire un test en regardant dans le rendu HTML si les informations attendues sont présentées comme prévu. Ce faisant, on teste le rendu du template en plus de la vue. Ce n’est pas forcément pertinent, donc réfléchissez bien à restreindre vos interfaces si vous pensez avoir vu trop large.</p>
</section>
</section>
<section id="organiser-les-tests">
<h2>Organiser les tests<a class="headerlink" href="#organiser-les-tests" title="Lien permanent vers cette rubrique"></a></h2>
<p>Cette section donne quelques conseils généraux pour vous aider à organiser vos tests.</p>
<section id="separer-les-niveaux-d-abstraction">
<h3>Séparer les niveaux d’abstraction<a class="headerlink" href="#separer-les-niveaux-d-abstraction" title="Lien permanent vers cette rubrique"></a></h3>
<p>On peut se retrouver à tout vouloir tester en même temps : les droits d’accès, les redirections,
le comportement dans différentes situations, etc. Pour faciliter les tests, considérez de séparer suivant différents aspects :</p>
<ul class="simple">
<li><p>les droits d’accès peuvent souvent être vérifiés sans aucunement tester le fonctionnel (erreur ou pas d’erreur) ;</p></li>
<li><p>les redirections peuvent se vérifier souvent indépendamment du fonctionnel (redirigé ou non) ;</p></li>
<li><p>le fonctionnel n’a par exemple pas besoin de s’entremêler avec la gestion des droits dans de nombreux cas.</p></li>
</ul>
<p>On peut observer un découpage dans cet esprit dans <code class="docutils literal notranslate"><span class="pre">./zds/tutorialv2/tests/tests_views/tests_editcontentlicense.py</span></code>.</p>
</section>
<section id="eviter-les-duplications">
<h3>Éviter les duplications<a class="headerlink" href="#eviter-les-duplications" title="Lien permanent vers cette rubrique"></a></h3>
<p>Quand on teste différents résultats attendus pour différentes entrées, on peut être amené à écrire du code qui a tendance à se répéter. Si tel est le cas, une bonne stratégie consiste à décrire les cas de tests sous forme de données (par exemple à l’aide d’un dictionnaire) et ensuite écrire une unique fonction de tests qui jouera tous les différents cas en appliquant la même logique à chaque fois.</p>
<p>Cette technique est par exemple employée dans <code class="docutils literal notranslate"><span class="pre">./zds/tutorialv2/tests/tests_views/tests_editcontentlicense.py</span></code>.</p>
</section>
<section id="decouper-en-fichiers">
<h3>Découper en fichiers<a class="headerlink" href="#decouper-en-fichiers" title="Lien permanent vers cette rubrique"></a></h3>
<p>Les fichiers de tests sur Zeste de Savoir sont historiquement assez longs, et peuvent atteindre plusieurs centaines voire plusieurs milliers de lignes. Mais ce n’est pas vraiment une bonne idée !</p>
<p>Si vous êtes amenés à rajouter plusieurs centaines de lignes de tests dans un fichier (ce qui est vite arrivé dans certains cas), considérez le choix de faire un fichier séparé.</p>
</section>
</section>
<section id="connaitre-les-outils-pratiques">
<h2>Connaître les outils pratiques<a class="headerlink" href="#connaitre-les-outils-pratiques" title="Lien permanent vers cette rubrique"></a></h2>
<p>Quelques lectures en lien avec Django :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.djangoproject.com/en/2.2/topics/testing/overview/">l’aperçu global des tests avec Django</a> ;</p></li>
<li><p><a class="reference external" href="https://docs.djangoproject.com/en/2.2/topics/testing/tools/">la documentation sur les outils de test fournis par Django</a>.</p></li>
</ul>
<p>Une tâche qui revient très souvent lors des tests est la création d’utilisateurs, sujets de forum, messages, tutoriels, articles, etc.
Il existe des outils de développement pour faciliter leur création appelés <em>Factory</em> et qu’on retrouve dans les fichiers <cite>factories.py</cite> de chaque module. L’usage est simple, il suffit d’appeler le constructeur pour recevoir un objet du type souhaité :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">ProfileFactory</span><span class="p">()</span>  <span class="c1"># self.author est un objet Profile !</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>N’hésitez pas à nous contacter !</strong> Si vous avez besoin d’aide ou si vous souhaitez simplement discuter du projet, contactez-nous sur le canal <code class="docutils literal notranslate"><span class="pre">#développement-de-zds</span></code> de <a class="reference external" href="https://discord.gg/ue5MTKq">notre serveur Discord</a> ou <a class="reference external" href="https://zestedesavoir.com/forums/communaute/dev-zone/">le forum Dev Zone</a>.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="backend-tests.html" class="btn btn-neutral float-left" title="Lancer les tests du backend" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="../install.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2022, Zeste de Savoir.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>